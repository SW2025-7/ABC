<h1>就活体験共有プラットフォーム (ABC)</h1>

<% if user_signed_in? %>
  <div style="margin-bottom: 20px; padding: 10px; background-color: #f9f9f9;">
    ログイン中: <strong><%= current_user.email %></strong><br>
    <%= link_to '新規投稿', new_post_path %> | 
    <%= link_to 'いいねした記事一覧', favorites_user_path(current_user) %> | 
    <%= button_to "ログアウト", destroy_user_session_path, method: :delete %>
  </div>
<% else %>
  <div style="margin-bottom: 20px;">
    <%= link_to "会員登録", new_user_registration_path %> | 
    <%= link_to "ログイン", new_user_session_path %>
  </div>
<% end %>

<div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 20px;">
  <%= search_form_for @q do |f| %>
    <%= f.label :title_cont, "キーワード検索" %>
    <%= f.search_field :title_cont %>
    <%= f.submit "検索" %>
  <% end %>
  <br>
  並び替え: 
  <%= sort_link(@q, :created_at, "新着順") %> | 
  <%= sort_link(@q, :likes_count, "いいねが多い順") %>
</div>

<% @posts.each do |post| %>
  <div style="border-bottom: 1px solid #ccc; padding: 15px 0;">
    <h3><%= post.title %> <small>(<%= post.category %>)</small></h3>
    <p><%= post.content %></p>
    <p style="font-size: 0.9em; color: gray;">
      開催日: 
      <% if post.event_date.present? %>
        <%= post.event_date.strftime('%Y年%m月%d日') %>
      <% else %>
        不明
      <% end %>
      場所: <%= post.location.presence || "未登録" %>
      投稿者: <%= post.user.name %> 
      いいね数: <%= post.likes_count %>
    </p>
    
    <% if user_signed_in? %>
      <% if current_user.already_liked?(post) %>
        <%= button_to 'いいねを取り消す', post_likes_path(post), method: :delete %>
      <% else %>
        <%= button_to 'いいね！', post_likes_path(post), method: :post %>
      <% end %>
      
      
      <% if current_user.id == post.user_id %>
          <%= button_to "削除", post_path(post), 
              method: :delete, 
              form: { data: { turbo_confirm: "本当に削除しますか？" } },
              style: "background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px;" 
          %>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
